<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ç‹é”™è¯¯ç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .error-button {
            background: #e74c3c;
        }
        .error-button:hover {
            background: #c0392b;
        }
        .warning-button {
            background: #f39c12;
        }
        .warning-button:hover {
            background: #e67e22;
        }
        .success-button {
            background: #27ae60;
        }
        .success-button:hover {
            background: #229954;
        }
        .info-box {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }
        h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        h3 {
            color: #34495e;
            margin-top: 0;
        }
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <h1>ğŸº é­”è¯é…’é¦† - è€ç‹é”™è¯¯ç³»ç»Ÿæµ‹è¯•</h1>

    <div class="test-section">
        <h3>ğŸ“‹ ç³»ç»Ÿä¿¡æ¯</h3>
        <div id="system-info" class="info-box">
            <p>æ­£åœ¨åˆå§‹åŒ–é”™è¯¯ç®¡ç†ç³»ç»Ÿ...</p>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ§ª é”™è¯¯ç±»å‹æµ‹è¯•</h3>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•ä¸åŒç±»å‹çš„é”™è¯¯æ”¶é›†ï¼š</p>

        <button class="test-button error-button" onclick="testSyntaxError()">è¯­æ³•é”™è¯¯</button>
        <button class="test-button error-button" onclick="testTypeError()">ç±»å‹é”™è¯¯</button>
        <button class="test-button error-button" onclick="testReferenceError()">å¼•ç”¨é”™è¯¯</button>
        <button class="test-button warning-button" onclick="testNetworkError()">ç½‘ç»œé”™è¯¯</button>
        <button class="test-button warning-button" onclick="testResourceError()">èµ„æºé”™è¯¯</button>
        <button class="test-button" onclick="testPromiseError()">Promiseé”™è¯¯</button>
        <button class="test-button" onclick="testManualError()">æ‰‹åŠ¨é”™è¯¯</button>
    </div>

    <div class="test-section">
        <h3>ğŸ”§ ç³»ç»ŸåŠŸèƒ½æµ‹è¯•</h3>
        <p>æµ‹è¯•é”™è¯¯ç®¡ç†ç³»ç»Ÿçš„å„é¡¹åŠŸèƒ½ï¼š</p>

        <button class="test-button success-button" onclick="showErrorReport()">æ˜¾ç¤ºé”™è¯¯æŠ¥å‘Š</button>
        <button class="test-button success-button" onclick="showErrorStats()">æ˜¾ç¤ºé”™è¯¯ç»Ÿè®¡</button>
        <button class="test-button" onclick="exportErrorReport()">å¯¼å‡ºé”™è¯¯æŠ¥å‘Š</button>
        <button class="test-button warning-button" onclick="clearErrorLog()">æ¸…ç©ºé”™è¯¯æ—¥å¿—</button>
    </div>

    <div class="test-section">
        <h3>ğŸ“Š é”™è¯¯ç»Ÿè®¡</h3>
        <div id="error-stats" class="info-box">
            <p>æš‚æ— é”™è¯¯ç»Ÿè®¡ä¿¡æ¯</p>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
        <div class="info-box">
            <p><strong>å¿«æ·é”®ï¼š</strong></p>
            <ul>
                <li><code>Ctrl+Shift+E</code> - æ˜¾ç¤ºé”™è¯¯æŠ¥å‘Š</li>
                <li><code>Ctrl+Shift+C</code> - æ¸…ç©ºé”™è¯¯æ—¥å¿—</li>
            </ul>
            <p><strong>åŠŸèƒ½è¯´æ˜ï¼š</strong></p>
            <ul>
                <li>é”™è¯¯ä¼šè‡ªåŠ¨æ”¶é›†å¹¶åˆ†ç±»ï¼ˆè¯­æ³•ã€ç±»å‹ã€ç½‘ç»œç­‰ï¼‰</li>
                <li>ä¸¥é‡é”™è¯¯ä¼šå®æ—¶æ˜¾ç¤ºé€šçŸ¥</li>
                <li>æ‰€æœ‰é”™è¯¯éƒ½ä¼šä¿å­˜åˆ°localStorageä¸­</li>
                <li>å¯ä»¥å¯¼å‡ºJSONæ ¼å¼çš„é”™è¯¯æŠ¥å‘Š</li>
            </ul>
        </div>
    </div>

    <!-- è€ç‹é”™è¯¯ç®¡ç†å™¨ -->
    <script src="js/utils/ErrorManager.js?v=20251007"></script>
    <script src="main.js?v=20251007"></script>

    <script>
        // ç³»ç»Ÿåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateSystemInfo();
            updateErrorStats();

            // å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            setInterval(updateErrorStats, 5000);
        });

        // æ›´æ–°ç³»ç»Ÿä¿¡æ¯
        function updateSystemInfo() {
            const infoDiv = document.getElementById('system-info');

            if (typeof errorManager !== 'undefined') {
                infoDiv.innerHTML = `
                    <p>âœ… è€ç‹é”™è¯¯ç®¡ç†ç³»ç»Ÿå·²åˆå§‹åŒ–å®Œæˆï¼</p>
                    <p>ğŸ“Š é”™è¯¯æ”¶é›†å™¨çŠ¶æ€: è¿è¡Œä¸­</p>
                    <p>ğŸ¯ é”™è¯¯åˆ†ç±»: 8ç§ç±»å‹</p>
                    <p>ğŸ’¾ å­˜å‚¨æ–¹å¼: localStorage</p>
                    <p>ğŸ”„ è‡ªåŠ¨ä¿å­˜: å·²å¯ç”¨</p>
                `;
            } else {
                infoDiv.innerHTML = `
                    <p>âŒ é”™è¯¯ç®¡ç†ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼</p>
                    <p>è¯·æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ã€‚</p>
                `;
            }
        }

        // æ›´æ–°é”™è¯¯ç»Ÿè®¡
        function updateErrorStats() {
            if (typeof getErrorStats === 'function') {
                const stats = getErrorStats();
                const statsDiv = document.getElementById('error-stats');

                if (stats) {
                    statsDiv.innerHTML = `
                        <p>ğŸ“ˆ æ€»é”™è¯¯æ•°: <strong>${stats.total}</strong></p>
                        <p>ğŸ”´ é«˜å±é”™è¯¯: ${stats.bySeverity.high || 0}</p>
                        <p>ğŸŸ¡ ä¸­å±é”™è¯¯: ${stats.bySeverity.medium || 0}</p>
                        <p>ğŸŸ¢ ä½å±é”™è¯¯: ${stats.bySeverity.low || 0}</p>
                        <p>ğŸ·ï¸ æœ€è¿‘5ä¸ªé”™è¯¯: </p>
                        <ul>
                            ${stats.recent.map(err => `
                                <li>${new Date(err.timestamp).toLocaleTimeString()}: ${err.title}</li>
                            `).join('')}
                        </ul>
                    `;
                } else {
                    statsDiv.innerHTML = '<p>æš‚æ— é”™è¯¯ç»Ÿè®¡ä¿¡æ¯</p>';
                }
            }
        }

        // æµ‹è¯•å‡½æ•°
        function testSyntaxError() {
            try {
                eval('const x = {');  // æ•…æ„åˆ¶é€ è¯­æ³•é”™è¯¯
            } catch (error) {
                console.log('è¯­æ³•é”™è¯¯å·²è§¦å‘');
            }
        }

        function testTypeError() {
            try {
                const obj = null;
                obj.someMethod();  // æ•…æ„åˆ¶é€ ç±»å‹é”™è¯¯
            } catch (error) {
                console.log('ç±»å‹é”™è¯¯å·²è§¦å‘');
            }
        }

        function testReferenceError() {
            try {
                undefinedFunction();  // æ•…æ„åˆ¶é€ å¼•ç”¨é”™è¯¯
            } catch (error) {
                console.log('å¼•ç”¨é”™è¯¯å·²è§¦å‘');
            }
        }

        function testNetworkError() {
            // æ¨¡æ‹Ÿç½‘ç»œé”™è¯¯
            fetch('https://nonexistent-domain-12345.com/api/data')
                .catch(error => {
                    console.log('ç½‘ç»œé”™è¯¯å·²è§¦å‘');
                    // æ‰‹åŠ¨æŠ¥å‘Šç½‘ç»œé”™è¯¯ç»™ErrorManager
                    if (typeof reportError === 'function') {
                        reportError(`ç½‘ç»œè¯·æ±‚å¤±è´¥: ${error.message}`, 'medium');
                    }
                });
        }

        function testResourceError() {
            // åˆ›å»ºä¸å­˜åœ¨çš„å›¾ç‰‡
            const img = new Image();
            img.src = 'https://nonexistent-domain-12345.com/image.png';
            document.body.appendChild(img);
            console.log('èµ„æºé”™è¯¯å·²è§¦å‘');
        }

        function testPromiseError() {
            // åˆ›å»ºè¢«æ‹’ç»çš„Promise
            Promise.reject(new Error('æµ‹è¯•Promiseé”™è¯¯'));
            console.log('Promiseé”™è¯¯å·²è§¦å‘');
        }

        function testManualError() {
            if (typeof reportError === 'function') {
                reportError('è¿™æ˜¯ä¸€ä¸ªæ‰‹åŠ¨æµ‹è¯•é”™è¯¯', 'medium');
                alert('æ‰‹åŠ¨é”™è¯¯å·²æ·»åŠ ï¼');
            } else {
                alert('é”™è¯¯ç®¡ç†å™¨æœªåˆå§‹åŒ–ï¼');
            }
        }

        function showErrorReport() {
            if (typeof errorManager !== 'undefined' && errorManager.showErrorReport) {
                errorManager.showErrorReport();
            } else {
                alert('é”™è¯¯æŠ¥å‘ŠåŠŸèƒ½æœªåˆå§‹åŒ–ï¼');
            }
        }

        function showErrorStats() {
            updateErrorStats();
            alert('é”™è¯¯ç»Ÿè®¡å·²æ›´æ–°ï¼');
        }

        function exportErrorReport() {
            if (typeof window.exportErrorReport === 'function') {
                window.exportErrorReport();
                alert('é”™è¯¯æŠ¥å‘Šå·²å¯¼å‡ºï¼');
            } else {
                alert('å¯¼å‡ºåŠŸèƒ½æœªåˆå§‹åŒ–ï¼');
            }
        }

        function clearErrorLog() {
            if (typeof errorManager !== 'undefined' && errorManager.clearErrors) {
                const stats = getErrorStats();
                if (stats && stats.total > 0) {
                    if (confirm(`ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ ${stats.total} ä¸ªé”™è¯¯æ—¥å¿—å—ï¼Ÿ`)) {
                        errorManager.clearErrors();
                        updateErrorStats();
                        // ä½¿ç”¨æ›´å‹å¥½çš„é€šçŸ¥æ–¹å¼æ›¿ä»£alert
                        const notification = document.createElement('div');
                        notification.style.cssText = `
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            background: #27ae60;
                            color: white;
                            padding: 15px 20px;
                            border-radius: 8px;
                            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                            z-index: 10000;
                            font-family: Arial, sans-serif;
                            animation: slideIn 0.3s ease-out;
                        `;
                        notification.textContent = 'âœ… é”™è¯¯æ—¥å¿—å·²æ¸…ç©ºï¼';
                        document.body.appendChild(notification);

                        // 3ç§’åè‡ªåŠ¨ç§»é™¤
                        setTimeout(() => {
                            if (notification.parentElement) {
                                notification.remove();
                            }
                        }, 3000);
                    }
                } else {
                    alert('å½“å‰æ²¡æœ‰é”™è¯¯æ—¥å¿—éœ€è¦æ¸…ç©º');
                }
            } else {
                alert('é”™è¯¯ç®¡ç†å™¨æœªåˆå§‹åŒ–ï¼');
            }
        }
    </script>
</body>
</html>